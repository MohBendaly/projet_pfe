<div class="container-fluid vh-100 d-flex flex-column p-3 bg-light">
  <!-- Titre -->
  <div class="mb-3 d-flex justify-content-between align-items-center">
    <h4 class="mb-0">
      <i class="pi pi-comments text-primary me-2"></i> Entretien #{{ interviewId }}
    </h4>
<!-- Button déclencheur -->
<button type="button" class="btn btn-danger btn-sm" (click)="openModal()">
  <i class="pi pi-times me-1"></i> Terminer
</button>

<!-- Modal Bootstrap -->
<div class="modal fade" id="confirmModal" tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true" #confirmModal>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="confirmModalLabel">Confirmer la fin de l'entretien</h5>
        <button type="button" class="btn-close" (click)="closeModal()" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        Êtes-vous sûr de vouloir terminer l'entretien ?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeModal()">Annuler</button>
        <button type="button" class="btn btn-danger" (click)="finishInterview()">Terminer</button>
      </div>
    </div>
  </div>
</div>
  </div>

  <!-- Zone de messages -->
  <div #scrollPanel class="flex-grow-1 overflow-auto p-3 bg-white rounded shadow-sm border mb-3">
    <ng-container *ngFor="let message of messages">
      <div
        class="d-flex mb-2"
        [ngClass]="{
          'justify-content-end': !message.isFromBot,
          'justify-content-start': message.isFromBot
        }"
      >
        <div
          class="p-2 rounded px-3"
          [ngClass]="{
            'bg-primary text-white align-self-end': !message.isFromBot,
            'bg-light border align-self-start': message.isFromBot
          }"
          style="max-width: 75%; word-wrap: break-word"
        >
          <small class="d-block text-muted mb-1">
            {{ message.timestamp | date: 'short' }}
          </small>
          {{ message.content }}
        </div>
      </div>
    </ng-container>

    <div *ngIf="interviewEnded" class="text-center mt-4 text-danger fw-bold">
      L'entretien est terminé.
    </div>
  </div>

  <!-- Formulaire d'envoi -->
  <form (ngSubmit)="sendMessage()" class="d-flex gap-2" [class.opacity-50]="interviewEnded" [class.pointer-events-none]="interviewEnded">
    <input
      type="text"
      [(ngModel)]="newMessage"
      name="messageInput"
      class="form-control"
      placeholder="Écrivez votre message..."
      [disabled]="interviewEnded"
    />
    <button
      type="submit"
      class="btn btn-primary"
      [disabled]="!newMessage.trim() || isSendingMessage"
    >
      <i class="pi pi-send"></i>
    </button>
  </form>
</div>

<!-- Dialog de confirmation -->
<p-confirmDialog></p-confirmDialog>

